<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Consulta Integrada</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .search-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .search-tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab-button {
            background: #ecf0f1;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            margin-right: 10px;
            font-size: 16px;
        }
        
        .tab-button.active {
            background: #3498db;
            color: white;
        }
        
        .search-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .search-button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .search-button:hover {
            background: #219a52;
        }
        
        .search-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .person-card, .company-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .person-card h3, .company-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .person-info, .company-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
        }
        
        .info-label {
            font-weight: bold;
            color: #34495e;
        }
        
        .people-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .person-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .person-item:hover {
            background-color: #f8f9fa;
        }
        
        .section-title {
            color: #2c3e50;
            margin: 20px 0 10px 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .companies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .partners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>Sistema de Consulta Integrada</h1>
                <p>Consulte informações de pessoas físicas e jurídicas</p>
            </div>
            
            <div class="search-section">
                <div class="search-tabs">
                    <button 
                        class="tab-button" 
                        :class="{ active: searchType === 'person' }"
                        @click="searchType = 'person'"
                    >
                        Buscar Pessoa (CPF/Nome)
                    </button>
                    <button 
                        class="tab-button" 
                        :class="{ active: searchType === 'company' }"
                        @click="searchType = 'company'"
                    >
                        Buscar Empresa (CNPJ)
                    </button>
                </div>
                
                <div class="search-form">
                    <input 
                        v-model="searchQuery" 
                        :placeholder="searchType === 'person' ? 'Digite o CPF ou nome da pessoa' : 'Digite o CNPJ da empresa'"
                        class="search-input"
                        @keyup.enter="search"
                    />
                    <button 
                        @click="search" 
                        :disabled="loading || !searchQuery.trim()"
                        class="search-button"
                    >
                        {{ loading ? 'Buscando...' : 'Buscar' }}
                    </button>
                </div>
            </div>
            
            <div v-if="error" class="error">
                {{ error }}
            </div>
            
            <div v-if="loading" class="loading">
                Carregando...
            </div>
            
            <div v-if="results && !loading" class="results">
                <!-- Lista de pessoas (busca por nome) -->
                <div v-if="results.type === 'people_list'">
                    <h2>Pessoas encontradas ({{ results.people.length }})</h2>
                    <div class="people-list">
                        <div 
                            v-for="person in results.people" 
                            :key="person.cpf"
                            class="person-item"
                            @click="selectPerson(person.cpf)"
                        >
                            <strong>{{ person.nome }}</strong><br>
                            <small>CPF: {{ formatCPF(person.cpf) }}</small>
                        </div>
                    </div>
                </div>
                
                <!-- Detalhes da pessoa e empresas -->
                <div v-if="results.type === 'person' || selectedPersonData">
                    <div class="person-card">
                        <h3>Dados da Pessoa</h3>
                        <div class="person-info">
                            <div class="info-item">
                                <div class="info-label">Nome:</div>
                                <div>{{ getPersonData().nome }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">CPF:</div>
                                <div>{{ formatCPF(getPersonData().cpf) }}</div>
                            </div>
                            <div class="info-item" v-if="getPersonData().sexo">
                                <div class="info-label">Sexo:</div>
                                <div>{{ getPersonData().sexo }}</div>
                            </div>
                            <div class="info-item" v-if="getPersonData().data_nascimento">
                                <div class="info-label">Data de Nascimento:</div>
                                <div>{{ formatDate(getPersonData().data_nascimento) }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <h2 class="section-title">Empresas Associadas ({{ getCompanies().length }})</h2>
                    <div class="companies-grid">
                        <div v-for="company in getCompanies()" :key="company.cnpj" class="company-card">
                            <h3>{{ company.razao_social }}</h3>
                            <div class="company-info">
                                <div class="info-item">
                                    <div class="info-label">CNPJ:</div>
                                    <div>{{ formatCNPJ(company.cnpj) }}</div>
                                </div>
                                <div class="info-item" v-if="company.nome_fantasia">
                                    <div class="info-label">Nome Fantasia:</div>
                                    <div>{{ company.nome_fantasia }}</div>
                                </div>
                                <div class="info-item" v-if="company.situacao">
                                    <div class="info-label">Situação:</div>
                                    <div>{{ company.situacao }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Detalhes da empresa e sócios -->
                <div v-if="results.type === 'company'">
                    <div class="company-card">
                        <h3>Dados da Empresa</h3>
                        <div class="company-info">
                            <div class="info-item">
                                <div class="info-label">CNPJ:</div>
                                <div>{{ formatCNPJ(results.company.cnpj) }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Razão Social:</div>
                                <div>{{ results.company.razao_social }}</div>
                            </div>
                            <div class="info-item" v-if="results.company.nome_fantasia">
                                <div class="info-label">Nome Fantasia:</div>
                                <div>{{ results.company.nome_fantasia }}</div>
                            </div>
                            <div class="info-item" v-if="results.company.situacao">
                                <div class="info-label">Situação:</div>
                                <div>{{ results.company.situacao }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <h2 class="section-title">Sócios ({{ results.partners.length }})</h2>
                    <div class="partners-grid">
                        <div v-for="partner in results.partners" :key="partner.cpf" class="person-card">
                            <h3>{{ partner.nome }}</h3>
                            <div class="person-info">
                                <div class="info-item">
                                    <div class="info-label">CPF:</div>
                                    <div>{{ formatCPF(partner.cpf) }}</div>
                                </div>
                                <div class="info-item" v-if="partner.sexo">
                                    <div class="info-label">Sexo:</div>
                                    <div>{{ partner.sexo }}</div>
                                </div>
                                <div class="info-item" v-if="partner.data_nascimento">
                                    <div class="info-label">Data de Nascimento:</div>
                                    <div>{{ formatDate(partner.data_nascimento) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    searchType: 'person',
                    searchQuery: '',
                    loading: false,
                    error: null,
                    results: null,
                    selectedPersonData: null
                };
            },
            methods: {
                async search() {
                    if (!this.searchQuery.trim()) return;
                    
                    this.loading = true;
                    this.error = null;
                    this.results = null;
                    this.selectedPersonData = null;
                    
                    try {
                        let response;
                        
                        if (this.searchType === 'person') {
                            response = await axios.post('http://localhost:5000/api/search_person', {
                                query: this.searchQuery
                            });
                        } else {
                            response = await axios.post('http://localhost:5000/api/search_company', {
                                cnpj: this.searchQuery
                            });
                        }
                        
                        this.results = response.data;
                    } catch (err) {
                        this.error = err.response?.data?.error || 'Erro ao buscar dados';
                    } finally {
                        this.loading = false;
                    }
                },
                
                async selectPerson(cpf) {
                    this.loading = true;
                    this.error = null;
                    
                    try {
                        const response = await axios.post('http://localhost:5000/api/person_companies', {
                            cpf: cpf
                        });
                        
                        this.selectedPersonData = response.data;
                    } catch (err) {
                        this.error = err.response?.data?.error || 'Erro ao buscar dados da pessoa';
                    } finally {
                        this.loading = false;
                    }
                },
                
                getPersonData() {
                    if (this.selectedPersonData) {
                        return this.selectedPersonData.person;
                    }
                    return this.results?.person || {};
                },
                
                getCompanies() {
                    if (this.selectedPersonData) {
                        return this.selectedPersonData.companies || [];
                    }
                    return this.results?.companies || [];
                },
                
                formatCPF(cpf) {
                    if (!cpf) return '';
                    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                },
                
                formatCNPJ(cnpj) {
                    if (!cnpj) return '';
                    return cnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
                },
                
                formatDate(date) {
                    if (!date) return '';
                    return new Date(date).toLocaleDateString('pt-BR');
                }
            }
        }).mount('#app');
    </script>
</body>
</html>